<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Further survival analyses</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Further survival analyses</h1>



<div id="set-up" class="section level2">
<h2>Set up</h2>
<p>Let us first load the packages required.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(CDMConnector)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(CohortSurvival)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code></pre></div>
<p>We will create a cdm reference to use our example MGUS2 survival
dataset.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> CohortSurvival<span class="sc">::</span><span class="fu">mockMGUS2cdm</span>()</span></code></pre></div>
<p>The CohortSurvival package does not have implemented functionality to
do more complex survival analyses than Kaplar Meier curves, like Cox
Proportional Hazards modelling. However, the format the data has to be
in to be inputted to well-known modelling functions from packages like
<code>survival</code> or <code>cmprsk</code>can be retrieved from OMOP
data with some in-built functions in this package. Let us see how to do
it in both single event and competing risk survival settings.</p>
</div>
<div id="further-analysis-with-single-event-survival" class="section level2">
<h2>Further analysis with single event survival</h2>
<p>To get the <code>time</code> and <code>status</code> information we
need for the <code>coxph</code> function in the package
<code>survival</code>, for instance, we only need to call
<code>addCohortSurvival</code>. The stratification variables need to be
columns previously added to the cohort by the user.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>input_survival_single <span class="ot">&lt;-</span> cdm<span class="sc">$</span>mgus_diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>       <span class="fu">addCohortSurvival</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>       <span class="at">cdm =</span> cdm,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>       <span class="at">outcomeCohortTable =</span> <span class="st">&quot;death_cohort&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>       <span class="at">outcomeCohortId =</span> <span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>       ) </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>input_survival_single <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; Rows: ??</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; Columns: 13</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; Database: DuckDB v1.2.0 [lopezk@Windows 10 x64:R 4.3.2/:memory:]</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; $ subject_id           &lt;int&gt; 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 14, 15, 16, 17, …</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1968-01-01, 1980-01-01, 1977-01-01, 1973-01-01, …</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1968-01-01, 1980-01-01, 1977-01-01, 1973-01-01, …</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; $ age                  &lt;dbl&gt; 78, 94, 68, 90, 90, 89, 87, 79, 86, 89, 80, 85, 9…</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; $ sex                  &lt;fct&gt; F, M, M, F, M, F, F, F, M, F, F, M, F, F, M, M, M…</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; $ hgb                  &lt;dbl&gt; 11.5, 10.5, 15.2, 10.7, 12.9, 10.5, 12.3, 9.4, 11…</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; $ creat                &lt;dbl&gt; 1.20, 1.50, 1.20, 0.80, 1.00, 0.90, 1.20, 1.10, 1…</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; $ mspike               &lt;dbl&gt; 2.0, 2.6, 1.2, 1.0, 0.5, 1.3, 1.6, 2.3, 2.3, 1.2,…</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; $ age_group            &lt;chr&gt; &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&lt;70&quot;, &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&gt;…</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; $ days_to_exit         &lt;int&gt; 25, 46, 92, 8, 4, 151, 2, 136, 2, 108, 14, 18, 43…</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; $ status               &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; $ time                 &lt;dbl&gt; 25, 46, 92, 8, 4, 151, 2, 136, 2, 108, 14, 18, 43…</span></span></code></pre></div>
<p>We can decide to change some of the default parameters in this
function. Information on all these can be found
<code>?addCohortSurvival</code>. For instance, we can choose to exclude
people with an outcome only 180 days before index date, instead of
anytime, and follow them up for only one year. We can also decide to use
<code>cohort_end_date</code> as their outcome variable and censor them
at a particular date, for instance, the 1st of January of 1994. We see
how that gives us different results:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>cdm<span class="sc">$</span>mgus_diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>       <span class="fu">addCohortSurvival</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>       <span class="at">cdm =</span> cdm,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>       <span class="at">outcomeCohortTable =</span> <span class="st">&quot;death_cohort&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>       <span class="at">outcomeWashout =</span> <span class="dv">180</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>       <span class="at">followUpDays =</span> <span class="dv">365</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="fu">filter</span>(cohort_start_date <span class="sc">&gt;</span> <span class="st">&quot;1993-01-01&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; Rows: ??</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; Columns: 13</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; Database: DuckDB v1.2.0 [lopezk@Windows 10 x64:R 4.3.2/:memory:]</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; $ subject_id           &lt;int&gt; 213, 1245, 1248, 1340, 1374, 1376, 1380, 1384, 94…</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1994-01-01, 1994-01-01, 1994-01-01, 1994-01-01, …</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1994-01-01, 1994-01-01, 1994-01-01, 1994-01-01, …</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; $ age                  &lt;dbl&gt; 93, 82, 87, 67, 68, 67, 69, 79, 85, 81, 66, 86, 8…</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; $ sex                  &lt;fct&gt; F, M, M, F, F, F, M, M, M, M, M, F, F, F, F, F, M…</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; $ hgb                  &lt;dbl&gt; 12.8, 11.4, 12.7, 12.2, 9.2, 13.7, 15.0, 9.6, 13.…</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; $ creat                &lt;dbl&gt; 1.1, 1.5, 1.5, 1.4, 1.8, 1.1, 0.8, 1.1, 1.1, 1.4,…</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; $ mspike               &lt;dbl&gt; 0.8, 1.4, 0.5, 1.2, 0.5, 1.5, 0.0, 1.7, 1.5, 1.3,…</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; $ age_group            &lt;chr&gt; &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&lt;70&quot;, &quot;&lt;70&quot;, &quot;&lt;70&quot;, &quot;&lt;70…</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; $ days_to_exit         &lt;dbl&gt; 19, 1, 10, 46, 40, 41, 22, 6, 12, 43, 31, 57, 52,…</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; $ status               &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0…</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; $ time                 &lt;dbl&gt; 19, 1, 10, 46, 40, 41, 22, 6, 12, 43, 31, 57, 52,…</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>cdm<span class="sc">$</span>mgus_diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>       <span class="fu">addCohortSurvival</span>(</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>       <span class="at">cdm =</span> cdm,</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>       <span class="at">outcomeCohortTable =</span> <span class="st">&quot;death_cohort&quot;</span>,</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>       <span class="at">outcomeDateVariable =</span> <span class="st">&quot;cohort_end_date&quot;</span>,</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>       <span class="at">censorOnDate =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1994-01-01&quot;</span>)</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>    <span class="fu">filter</span>(cohort_start_date <span class="sc">&gt;</span> <span class="st">&quot;1993-01-01&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; Rows: ??</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#&gt; Columns: 13</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#&gt; Database: DuckDB v1.2.0 [lopezk@Windows 10 x64:R 4.3.2/:memory:]</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="co">#&gt; $ subject_id           &lt;int&gt; 213, 1245, 1248, 1340, 1374, 1376, 1380, 1384, 94…</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1994-01-01, 1994-01-01, 1994-01-01, 1994-01-01, …</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1994-01-01, 1994-01-01, 1994-01-01, 1994-01-01, …</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a><span class="co">#&gt; $ age                  &lt;dbl&gt; 93, 82, 87, 67, 68, 67, 69, 79, 85, 81, 66, 86, 8…</span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="co">#&gt; $ sex                  &lt;fct&gt; F, M, M, F, F, F, M, M, M, M, M, F, F, F, F, F, M…</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="co">#&gt; $ hgb                  &lt;dbl&gt; 12.8, 11.4, 12.7, 12.2, 9.2, 13.7, 15.0, 9.6, 13.…</span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="co">#&gt; $ creat                &lt;dbl&gt; 1.1, 1.5, 1.5, 1.4, 1.8, 1.1, 0.8, 1.1, 1.1, 1.4,…</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="co">#&gt; $ mspike               &lt;dbl&gt; 0.8, 1.4, 0.5, 1.2, 0.5, 1.5, 0.0, 1.7, 1.5, 1.3,…</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="co">#&gt; $ age_group            &lt;chr&gt; &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&gt;=70&quot;, &quot;&lt;70&quot;, &quot;&lt;70&quot;, &quot;&lt;70&quot;, &quot;&lt;70…</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a><span class="co">#&gt; $ days_to_exit         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a><span class="co">#&gt; $ status               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a><span class="co">#&gt; $ time                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span></code></pre></div>
<p>This table with the added <code>time</code> and <code>status</code>
information should be enough to call any advanced function, like the
aforementioned Cox Proportional Hazards model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>survival<span class="sc">::</span><span class="fu">coxph</span>(survival<span class="sc">::</span><span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> input_survival_single)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; survival::coxph(formula = survival::Surv(time, status) ~ age + </span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;     sex, data = input_survival_single)</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;          coef exp(coef) se(coef)      z        p</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; age  0.061622  1.063561 0.003402 18.114  &lt; 2e-16</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; sexM 0.358258  1.430835 0.065693  5.454 4.94e-08</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; Likelihood ratio test=391.2  on 2 df, p=&lt; 2.2e-16</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; n= 1384, number of events= 963</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>survival<span class="sc">::</span><span class="fu">survdiff</span>(survival<span class="sc">::</span><span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> input_survival_single)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; survival::survdiff(formula = survival::Surv(time, status) ~ sex, </span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;     data = input_survival_single)</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;         N Observed Expected (O-E)^2/E (O-E)^2/V</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; sex=F 631      423      471      4.88      9.67</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; sex=M 753      540      492      4.67      9.67</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt;  Chisq= 9.7  on 1 degrees of freedom, p= 0.002</span></span></code></pre></div>
</div>
<div id="further-analysis-with-competing-risk-survival" class="section level2">
<h2>Further analysis with competing risk survival</h2>
<p>For competing risk settings, we need to use the same function that
adds <code>time</code> and <code>status</code> information, but twice.
We first need to add time and status information for the outcome, then
for the competing outcome. Then we leverage all those variables to get
what outcome (if any) to count per individual so that we can feed the
result to subsequent models.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># Add all status and time information for both outcomes</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  input_survival_cr <span class="ot">&lt;-</span> cdm<span class="sc">$</span>mgus_diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="fu">addCohortSurvival</span>(cdm, <span class="st">&quot;progression&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      <span class="st">&quot;outcome_time&quot;</span> <span class="ot">=</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="st">&quot;outcome_status&quot;</span> <span class="ot">=</span> <span class="st">&quot;status&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>     <span class="fu">addCohortSurvival</span>(cdm, <span class="st">&quot;death_cohort&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>      <span class="st">&quot;competing_outcome_time&quot;</span> <span class="ot">=</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>      <span class="st">&quot;competing_outcome_status&quot;</span> <span class="ot">=</span> <span class="st">&quot;status&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    )</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  </span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  <span class="co"># Collect and </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  input_survival_cr <span class="ot">&lt;-</span> input_survival_cr <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">collect</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>      <span class="at">time =</span> <span class="fu">pmin</span>(outcome_time, competing_outcome_time),</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>      <span class="at">status =</span> <span class="fu">factor</span>(</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">if_else</span>(competing_outcome_time <span class="sc">&lt;=</span> outcome_time, <span class="dv">2</span> <span class="sc">*</span> competing_outcome_status, outcome_status))</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;outcome_time&quot;</span>, <span class="st">&quot;outcome_status&quot;</span>, <span class="st">&quot;competing_outcome_time&quot;</span>, <span class="st">&quot;competing_outcome_status&quot;</span>))</span></code></pre></div>
<p>We can use the package <code>cmprsk</code> to fit a Fine and Gray
model to the competing risk data. We first change our <code>sex</code>
covariate to numeric, and then we can run the analysis:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>input_survival_cr <span class="ot">&lt;-</span> input_survival_cr <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sex =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">&quot;M&quot;</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(input_survival_cr<span class="sc">$</span>age, input_survival_cr<span class="sc">$</span>sex)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">names</span>(covs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">summary</span>(cmprsk<span class="sc">::</span><span class="fu">crr</span>(<span class="at">ftime =</span> input_survival_cr<span class="sc">$</span>time,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>            <span class="at">fstatus =</span> input_survival_cr<span class="sc">$</span>status,</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>            <span class="at">cov1 =</span> covs,</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>            <span class="at">failcode =</span> <span class="dv">1</span>,</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>            <span class="at">cencode =</span> <span class="dv">0</span>))</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; Competing Risks Regression</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; cmprsk::crr(ftime = input_survival_cr$time, fstatus = input_survival_cr$status, </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;     cov1 = covs, failcode = 1, cencode = 0)</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;        coef exp(coef) se(coef)     z p-value</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; age -0.0192     0.981  0.00585 -3.28   0.001</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; sex  0.2871     1.333  0.19309  1.49   0.140</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;     exp(coef) exp(-coef)  2.5% 97.5%</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; age     0.981       1.02 0.970 0.992</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; sex     1.333       0.75 0.913 1.945</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; Num. cases = 1384</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt; Pseudo Log-likelihood = -726 </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; Pseudo likelihood ratio test = 8.32  on 2 df,</span></span></code></pre></div>
</div>
<div id="disconnect-from-the-cdm-database-connection" class="section level2">
<h2>Disconnect from the cdm database connection</h2>
<p>We finish by disconnecting from the cdm database connection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">cdmDisconnect</span>(cdm)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
